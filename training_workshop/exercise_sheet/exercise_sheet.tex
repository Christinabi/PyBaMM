%%% Template originaly created by Karol Kozio≈Ç (mail@karol-koziol.net) and modified for ShareLaTeX use

\documentclass[a4paper,11pt]{article}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{xcolor}

\renewcommand\familydefault{\sfdefault}
\usepackage{sansmath}
\sansmath
\usepackage{tgheros}
\usepackage[defaultmono]{droidmono}

\usepackage{amsmath,amssymb,amsthm,physics,textcomp}
\usepackage{enumerate}
\usepackage{multicol}
\usepackage{tikz}

\usepackage{geometry}
\geometry{total={210mm,297mm},
left=25mm,right=25mm,%
bindingoffset=0mm, top=20mm,bottom=20mm}


\linespread{1.3}

\newcommand{\linia}{\rule{\linewidth}{0.5pt}}

% custom theorems if needed
\newtheoremstyle{mytheor}
    {1ex}{1ex}{\normalfont}{0pt}{\scshape}{.}{1ex}
    {{\thmname{#1 }}{\thmnumber{#2}}{\thmnote{ (#3)}}}

\theoremstyle{mytheor}
\newtheorem{defi}{Definition}

% my own titles
\makeatletter
\renewcommand{\maketitle}{
\begin{center}
\vspace{2ex}
{\huge \textsc{\@title}}
\vspace{1ex}
\\
\linia\\
\@author \hfill \@date
\vspace{4ex}
\end{center}
}
\makeatother
%%%

% custom footers and headers
\usepackage{fancyhdr}
\pagestyle{fancy}
\lhead{}
\chead{}
\rhead{}
\lfoot{PyBaMM Training Workshop}
\cfoot{}
\rfoot{Page \thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
%

% code listing settings
\usepackage{listings}
\lstset{
    language=Python,
    basicstyle=\ttfamily\small,
    aboveskip={1.0\baselineskip},
    belowskip={1.0\baselineskip},
    columns=fixed,
    extendedchars=true,
    breaklines=true,
    tabsize=4,
    prebreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
    frame=lines,
    showtabs=false,
    showspaces=false,
    showstringspaces=false,
    keywordstyle=\color[rgb]{0.627,0.126,0.941},
    commentstyle=\color[rgb]{0.133,0.545,0.133},
    stringstyle=\color[rgb]{01,0,0},
    numbers=left,
    numberstyle=\small,
    stepnumber=1,
    numbersep=10pt,
    captionpos=t,
    escapeinside={\%*}{*)}
}

%%%----------%%%----------%%%----------%%%----------%%%

\begin{document}

\title{\textbf{P}ython \textbf{Ba}ttery \textbf{M}athematical \textbf{M}odelling Training Workshop}

\author{Oxford University}

\date{31st July - 1st August 2019}

\maketitle

\section*{Exercise 1 -- solving ODEs in PyBaMM}

Using the examples available in the PyBaMM repository, write a script which solves the following system of ODEs:
\begin{align*}
  \dv{x}{t} &= 2x, \quad x(0) = 1, \\
  \dv{y}{t} &= -x, \quad y(0) = -0.5.
\end{align*}


\begin{lstlisting}[label={Ex1},caption=Solving ODEs in PyBaMM.]
import pybamm
import numpy as np
import matplotlib.pyplot as plt

# 1. Initialise an empty model
model = pybamm.BaseModel()

# 2. Define variables
x = pybamm.Variable("x")
y = pybamm.Variable("y")

# 3. State governing equations
dxdt = 2 * x
dydt = -x

model.rhs = {x: dxdt, y: dydt}  # add equations to rhs dictionary

# 4. State initial conditions
model.initial_conditions = {x: pybamm.Scalar(1), y: pybamm.Scalar(-0.5)}

# 6. State output variables
model.variables = {"x": x, "y": y}

"Using the model"

# use default discretisation
disc = pybamm.Discretisation()
disc.process_model(model)

# solve
solver = pybamm.ScipySolver()
t = np.linspace(0, 1, 20)
solution = solver.solve(model, t)

# post-process, so that the solutions can be called at any time t (using interpolation)
t_sol, y_sol = solution.t, solution.y
x = pybamm.ProcessedVariable(model.variables["x"], t_sol, y_sol)
y = pybamm.ProcessedVariable(model.variables["y"], t_sol, y_sol)

# plot
t_fine = np.linspace(0, t[-1], 1000)

fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(13, 4))
ax1.plot(t_fine, np.exp(2 * t_fine), t_sol, x(t_sol), "o")
ax1.set_xlabel("t")
ax1.legend(["exp(2*t)", "x"], loc="best")

ax2.plot(t_fine, -0.5 * np.exp(2 * t_fine), t_sol, y(t_sol), "o")
ax2.set_xlabel("t")
ax2.legend(["0.5*exp(2*t)", "y"], loc="best")

plt.tight_layout()
plt.show()
\end{lstlisting}


\end{document}
