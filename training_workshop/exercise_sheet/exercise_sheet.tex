%%% Template originaly created by Karol Kozio≈Ç (mail@karol-koziol.net) and modified for ShareLaTeX use

\documentclass[a4paper,11pt]{article}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{xcolor}

\renewcommand\familydefault{\sfdefault}
\usepackage{sansmath}
\sansmath
\usepackage{tgheros}
\usepackage[defaultmono]{droidmono}

\usepackage{amsmath,amssymb,amsthm,booktabs,physics,siunitx,textcomp}
\usepackage{enumerate}
\usepackage{multicol}
\usepackage{tikz}

\usepackage{geometry}
\geometry{total={210mm,297mm},
left=25mm,right=25mm,%
bindingoffset=0mm, top=20mm,bottom=20mm}

\setlength\parindent{0ex}
\setlength{\parskip}{1ex}
\usepackage{setspace}
\onehalfspacing

\newcommand{\linia}{\rule{\linewidth}{0.5pt}}

% my own titles
\makeatletter
\renewcommand{\maketitle}{
\begin{center}
\vspace{2ex}
{\huge \textsc{\@title}}
\vspace{1ex}
\\
\linia\\
\@author \hfill \@date
\vspace{4ex}
\end{center}
}
\makeatother
%%%

% custom footers and headers
\usepackage{fancyhdr}
\pagestyle{fancy}
\lhead{}
\chead{}
\rhead{}
\lfoot{PyBaMM Training Workshop}
\cfoot{}
\rfoot{Page \thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
%

% code listing settings
\usepackage{listings}
\lstset{
    language=Python,
    basicstyle=\ttfamily\small,
    aboveskip={1.0\baselineskip},
    belowskip={1.0\baselineskip},
    columns=fixed,
    extendedchars=true,
    breaklines=true,
    tabsize=4,
    prebreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
    frame=lines,
    showtabs=false,
    showspaces=false,
    showstringspaces=false,
    keywordstyle=\color[rgb]{0.627,0.126,0.941},
    commentstyle=\color[rgb]{0.133,0.545,0.133},
    stringstyle=\color[rgb]{01,0,0},
    numbers=left,
    numberstyle=\small,
    stepnumber=1,
    numbersep=10pt,
    captionpos=t,
    escapeinside={\%*}{*)}
}

%%%----------%%%----------%%%----------%%%----------%%%

\begin{document}

\title{\textbf{P}ython \textbf{Ba}ttery \textbf{M}athematical \textbf{M}odelling Training Workshop}

\author{Oxford University}

\date{31st July - 1st August 2019}

\maketitle

\section*{Exercise 1 -- solving ODEs in PyBaMM}

Using the examples available in the PyBaMM repository, write a script which solves the following system of ODEs:
\begin{align*}
  \dv{x}{t} &= 4x - 2y, \quad x(0) = 1, \\
  \dv{y}{t} &= 3x - y, \quad y(0) = 2.
\end{align*}
You can try to write the script from scratch, or copy the code below and fill in the blanks.


\begin{lstlisting}[label={Ex1},caption=Solving ODEs script]
import pybamm
import numpy as np
import matplotlib.pyplot as plt

"Setting up the model"

# 1. Initialise an empty model
model = pybamm.BaseModel()

# 2. Define variables
## DEFINE YOUR VARIABLES HERE ##

# 3. State governing equations
## WRITE THE EQUATIONS HERE ##

model.rhs = {}

# 4. State initial conditions
## ADD INITIAL CONDITIONS HERE ##

model.initial_conditions = {}

# 6. State output variables
## STATE OUTPUT VARIABLES HERE ##

"Using the model"

# use default discretisation
disc = pybamm.Discretisation()
## PROCESS MODEL USING THE GIVEN DISCRETISTAION ##

# solve
solver = pybamm.ScipySolver()
## SOLVE MODEL USING THE GIVEN SOLVER ##

# post-process, so that the solutions can be called at any time t (using interpolation)
## PROCESS THE SOLUTION FOR PLOTTING ##

# plot
## PLOT SOLUTION ##
\end{lstlisting}

\section*{Exercise 2 -- solving PDEs in PyBaMM}
Write a script to solve the problem of linear diffusion on a unit sphere,
\begin{equation*}
  \pdv{c}{t} = \nabla \cdot (\nabla c),
\end{equation*}
with the following boundary and initial conditions:
\begin{equation*}
  \left.\pdv{c}{r}\right\vert_{r=0} = 0, \quad \left.\pdv{c}{r}\right\vert_{r=1} = 2, \quad \left.c\right\vert_{t=0} = 1.
\end{equation*}

Try solving the model again with different boundary or initial conditions.

\section*{Exercise 3 -- extending the PDE model}
In PyBaMM, paramater objects can be used to define paramaters whose value is set during processing of the model. In practice, paramater values can be read in from and external source, such as a .csv file, but they can also be set in a dictionary before model processing. Try to extend your model to include a diffusion coefficient $D$, i.e. solve
\begin{equation*}
  \pdv{c}{t} = \nabla \cdot (D \nabla c),
\end{equation*}

\begin{lstlisting}[label={Ex3_parameter},caption=Adding a parameter and setting its value]
D = pybamm.Parameter("Diffusion coefficient")
param = pybamm.ParameterValues({"Diffusion coefficient": 0.5})
\end{lstlisting}

Try adding more paramters to your model, or changing the parameter values.

You can also add additional output variables to your model which can be accessed after the solve. For instance, you may interested in the flux as well as the concentration. Extra output variables are easily added to the model.variables dictionary in PyBaMM.

\begin{lstlisting}[label={Ex3_extra_vars},caption=Adding extra output variables]
model.variables = {"Concentration": c, "Flux": N}
\end{lstlisting}

\section*{Exercise 4 -- the negative partice problem}
Now it is time to solve a real-life battery problem! Adapt your linear diffusion model to solve the problem of diffusion in the negetive electrode particle within the single paticle model. That is,
\begin{equation*}
  \pdv{c}{t} = \nabla \cdot (D \nabla c),
\end{equation*}
with the following boundary and initial conditions:
\begin{equation*}
  \left.\pdv{c}{r}\right\vert_{r=0} = 0, \quad \left.\pdv{c}{r}\right\vert_{r=R} = -\frac{j}{FD}, \quad \left.c\right\vert_{t=0} = c_0,
\end{equation*}
where $c$ is the concentration, $r$ the radial coordinate, $t$ time, $R$ the particle radius, $D$ the diffusion coefficient, $j$ the interfacial current density, $F$ Faraday's constant, and $c_0$ the initial concentration. Use the paramaters from Table~\ref{Table:Ex4}.

\begin{table}[htb]
	\centering
	\begin{tabular}{c c c}
	\toprule
     Symbol & Units & Value \\
    \midrule
    $R$ & \si{m} & $10 \times 10^{-6}$\\
    $D$ & \si{m^2.s^{-1}} & $3.9 \times 10^{-14}$ \\
    $j$ & \si{A.m^{-2}} & $1.4$ \\
    $F$ & \si{C.mol^{-1}} & $96485$ \\
    $c_0$ & \si{mol.m^{-3}} & $2.5 \times 10^4$ \\
    \bottomrule
    \end{tabular}
    \caption{Parameter values for use in Exercise 4.}
    \label{Table:Ex4}
\end{table}

\section*{Exercise 5 -- making a model class}

\end{document}
